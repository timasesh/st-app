{% load course_filters %}
<!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
<div id="rating" class="tab-pane">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
    <div class="rating-header-modern">
        <div class="rating-title-section">
            <h2 class="rating-main-title">
                <i class="fas fa-trophy animated-trophy"></i>
                –†–µ–π—Ç–∏–Ω–≥ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
            </h2>
            <p class="rating-subtitle">–°–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å, –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∑–≤—ë–∑–¥—ã –∏ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ—Å—å –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ!</p>
        </div>
        <div class="rating-stats-overview">
            <div class="overview-stat">
                <div class="overview-stat-icon">üë•</div>
                <div class="overview-stat-content">
                    <span class="overview-stat-number">{{ rating_groups|length }}</span>
                    <span class="overview-stat-label">–ì—Ä—É–ø–ø</span>
                </div>
            </div>
            <div class="overview-stat">
                <div class="overview-stat-icon">‚≠ê</div>
                <div class="overview-stat-content">
                    <span class="overview-stat-number">{{ user.student.stars }}</span>
                    <span class="overview-stat-label">–í–∞—à–∏ –∑–≤—ë–∑–¥—ã</span>
                </div>
            </div>
            <div class="overview-stat">
                <div class="overview-stat-icon">üèÜ</div>
                <div class="overview-stat-content">
                    <span class="overview-stat-number">{{ user.student.level_number }}</span>
                    <span class="overview-stat-label">–í–∞—à —É—Ä–æ–≤–µ–Ω—å</span>
                </div>
            </div>
        </div>
    </div>

    {% if rating_groups %}
        <div class="rating-groups-container-modern">
            {% for group in rating_groups %}
                <div class="group-rating-section">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä—É–ø–ø—ã -->
                    <div class="group-header-modern">
                        <div class="group-title-section">
                            <h3 class="group-name">
                                <i class="fas fa-users group-icon"></i>
                                {{ group.name }}
                            </h3>
                            <span class="group-members-count">{{ group.students_with_rating|length }} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                        </div>
                        <div class="group-decoration">
                            <div class="decoration-dot"></div>
                            <div class="decoration-dot"></div>
                            <div class="decoration-dot"></div>
                        </div>
                    </div>
                    
                    <!-- –ü–æ–¥–∏—É–º –¥–ª—è —Ç–æ–ø-3 -->
                    {% if group.students_with_rating|length >= 3 %}
                    <div class="podium-container">
                        <div class="podium-stage">
                            <!-- 2 –º–µ—Å—Ç–æ -->
                            {% with group.students_with_rating.1 as silver %}
                            <div class="podium-place second-place" data-position="2">
                                <div class="podium-student">
                                    {% if silver.student.avatar %}
                                        <img src="{{ silver.student.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="podium-avatar">
                                    {% else %}
                                        <div class="podium-avatar-placeholder">
                                            {% if silver.student.user.first_name %}{{ silver.student.user.first_name|first }}{% else %}{{ silver.student.user.username|first|upper }}{% endif %}
                                        </div>
                                    {% endif %}
                                    <div class="podium-crown silver-crown">ü•à</div>
                                </div>
                                <div class="podium-info">
                                    <h4 class="podium-name">
                                        {% if silver.student.user.first_name and silver.student.user.last_name %}
                                            {{ silver.student.user.first_name }} {{ silver.student.user.last_name }}
                                        {% else %}
                                            {{ silver.student.user.username }}
                                        {% endif %}
                                    </h4>
                                    <div class="podium-stars">‚≠ê {{ silver.student.stars }}</div>
                                </div>
                                <div class="podium-base silver-base">
                                    <span class="podium-position">2</span>
                                </div>
                            </div>
                            {% endwith %}
                            
                            <!-- 1 –º–µ—Å—Ç–æ -->
                            {% with group.students_with_rating.0 as gold %}
                            <div class="podium-place first-place" data-position="1">
                                <div class="podium-student">
                                    {% if gold.student.avatar %}
                                        <img src="{{ gold.student.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="podium-avatar">
                                    {% else %}
                                        <div class="podium-avatar-placeholder">
                                            {% if gold.student.user.first_name %}{{ gold.student.user.first_name|first }}{% else %}{{ gold.student.user.username|first|upper }}{% endif %}
                                        </div>
                                    {% endif %}
                                    <div class="podium-crown gold-crown">üëë</div>
                                </div>
                                <div class="podium-info">
                                    <h4 class="podium-name">
                                        {% if gold.student.user.first_name and gold.student.user.last_name %}
                                            {{ gold.student.user.first_name }} {{ gold.student.user.last_name }}
                                        {% else %}
                                            {{ gold.student.user.username }}
                                        {% endif %}
                                    </h4>
                                    <div class="podium-stars">‚≠ê {{ gold.student.stars }}</div>
                                </div>
                                <div class="podium-base gold-base">
                                    <span class="podium-position">1</span>
                                </div>
                            </div>
                            {% endwith %}
                            
                            <!-- 3 –º–µ—Å—Ç–æ -->
                            {% with group.students_with_rating.2 as bronze %}
                            <div class="podium-place third-place" data-position="3">
                                <div class="podium-student">
                                    {% if bronze.student.avatar %}
                                        <img src="{{ bronze.student.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="podium-avatar">
                                    {% else %}
                                        <div class="podium-avatar-placeholder">
                                            {% if bronze.student.user.first_name %}{{ bronze.student.user.first_name|first }}{% else %}{{ bronze.student.user.username|first|upper }}{% endif %}
                                        </div>
                                    {% endif %}
                                    <div class="podium-crown bronze-crown">ü•â</div>
                                </div>
                                <div class="podium-info">
                                    <h4 class="podium-name">
                                        {% if bronze.student.user.first_name and bronze.student.user.last_name %}
                                            {{ bronze.student.user.first_name }} {{ bronze.student.user.last_name }}
                                        {% else %}
                                            {{ bronze.student.user.username }}
                                        {% endif %}
                                    </h4>
                                    <div class="podium-stars">‚≠ê {{ bronze.student.stars }}</div>
                                </div>
                                <div class="podium-base bronze-base">
                                    <span class="podium-position">3</span>
                                </div>
                            </div>
                            {% endwith %}
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
                    <div class="rating-list-modern">
                        {% for student_data in group.students_with_rating %}
                            <div class="rating-card-modern {% if student_data.student.id == user.student.id %}current-user-card{% endif %} {% if student_data.position <= 3 %}top-position{% endif %}">
                                <div class="card-background-effect"></div>
                                
                                <!-- –ü–æ–∑–∏—Ü–∏—è -->
                                <div class="position-section">
                                    <div class="position-circle position-{{ student_data.position }}">
                                        {% if student_data.position == 1 %}
                                            <i class="fas fa-crown"></i>
                                        {% elif student_data.position == 2 %}
                                            <i class="fas fa-medal"></i>
                                        {% elif student_data.position == 3 %}
                                            <i class="fas fa-award"></i>
                                        {% else %}
                                            {{ student_data.position }}
                                        {% endif %}
                                    </div>
                                    {% if student_data.position <= 3 %}
                                        <div class="position-glow"></div>
                                    {% endif %}
                                </div>
                                
                                <!-- –ê–≤–∞—Ç–∞—Ä -->
                                <div class="avatar-section">
                                    {% if student_data.student.avatar %}
                                        <img src="{{ student_data.student.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="student-avatar-modern">
                                    {% else %}
                                        <div class="student-avatar-placeholder-modern">
                                            {% if student_data.student.user.first_name %}
                                                {{ student_data.student.user.first_name|first }}
                                            {% else %}
                                                {{ student_data.student.user.username|first|upper }}
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                    {% if student_data.student.id == user.student.id %}
                                        <div class="you-indicator">–í–´</div>
                                    {% endif %}
                                </div>
                                
                                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—É–¥–µ–Ω—Ç–µ -->
                                <div class="student-info-section">
                                    <h4 class="student-name-modern">
                                        {% if student_data.student.user.first_name and student_data.student.user.last_name %}
                                            {{ student_data.student.user.first_name }} {{ student_data.student.user.last_name }}
                                        {% else %}
                                            {{ student_data.student.user.username }}
                                        {% endif %}
                                    </h4>
                                    <p class="student-level-modern">
                                        {% if student_data.student.level %}
                                            <i class="fas fa-trophy level-icon-small"></i>
                                            {{ student_data.student.level.name }}
                                        {% else %}
                                            <i class="fas fa-seedling level-icon-small"></i>
                                            –ù–æ–≤–∏—á–æ–∫
                                        {% endif %}
                                    </p>
                                </div>
                                
                                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                                <div class="stats-section-modern">
                                    <div class="stars-display">
                                        <i class="fas fa-star stars-icon-modern"></i>
                                        <span class="stars-count">{{ student_data.student.stars }}</span>
                                    </div>
                                    {% if student_data.student.level %}
                                        <div class="level-display">
                                            <span class="level-number">{{ student_data.student.level.number }}</span>
                                            <span class="level-label">LVL</span>
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è —Ç–æ–ø –ø–æ–∑–∏—Ü–∏–π -->
                                {% if student_data.position <= 3 %}
                                    <div class="sparkle-effect">
                                        <div class="sparkle sparkle-1"></div>
                                        <div class="sparkle sparkle-2"></div>
                                        <div class="sparkle sparkle-3"></div>
                                    </div>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-groups-container-modern">
            <div class="no-groups-card-modern">
                <div class="no-groups-illustration">
                    <div class="illustration-circle">
                        <i class="fas fa-users no-groups-icon-modern"></i>
                    </div>
                    <div class="floating-elements">
                        <div class="floating-star">‚≠ê</div>
                        <div class="floating-trophy">üèÜ</div>
                        <div class="floating-crown">üëë</div>
                    </div>
                </div>
                <h3 class="no-groups-title-modern">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ –≥—Ä—É–ø–ø–µ!</h3>
                <p class="no-groups-text-modern">–ß—Ç–æ–±—ã —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç—å—Å—è —Å –¥—Ä—É–≥–∏–º–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏, –≤–∞–º –Ω—É–∂–Ω–æ –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º –≤ –≥—Ä—É–ø–ø—É.</p>
                <div class="no-groups-action">
                    <button class="contact-admin-btn" onclick="switchTab('requests')">
                        <i class="fas fa-paper-plane"></i>
                        –°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
                    </button>
                </div>
            </div>
        </div>
    {% endif %}
</div>
